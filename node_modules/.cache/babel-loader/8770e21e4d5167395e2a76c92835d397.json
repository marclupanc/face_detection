{"ast":null,"code":"import { __spreadArrays } from \"tslib\";\nimport * as tf from '@tensorflow/tfjs-core';\nimport { conv, convDown, convNoRelu } from './convLayer';\nexport function residual(x, params) {\n  var out = conv(x, params.conv1);\n  out = convNoRelu(out, params.conv2);\n  out = tf.add(out, x);\n  out = tf.relu(out);\n  return out;\n}\nexport function residualDown(x, params) {\n  var out = convDown(x, params.conv1);\n  out = convNoRelu(out, params.conv2);\n  var pooled = tf.avgPool(x, 2, 2, 'valid');\n  var zeros = tf.zeros(pooled.shape);\n  var isPad = pooled.shape[3] !== out.shape[3];\n  var isAdjustShape = pooled.shape[1] !== out.shape[1] || pooled.shape[2] !== out.shape[2];\n\n  if (isAdjustShape) {\n    var padShapeX = __spreadArrays(out.shape);\n\n    padShapeX[1] = 1;\n    var zerosW = tf.zeros(padShapeX);\n    out = tf.concat([out, zerosW], 1);\n\n    var padShapeY = __spreadArrays(out.shape);\n\n    padShapeY[2] = 1;\n    var zerosH = tf.zeros(padShapeY);\n    out = tf.concat([out, zerosH], 2);\n  }\n\n  pooled = isPad ? tf.concat([pooled, zeros], 3) : pooled;\n  out = tf.add(pooled, out);\n  out = tf.relu(out);\n  return out;\n}","map":{"version":3,"mappings":";AAAA,OAAO,KAAKA,EAAZ,MAAoB,uBAApB;AAEA,SAASC,IAAT,EAAeC,QAAf,EAAyBC,UAAzB,QAA2C,aAA3C;AAGA,OAAM,SAAUC,QAAV,CAAmBC,CAAnB,EAAmCC,MAAnC,EAA8D;EAClE,IAAIC,GAAG,GAAGN,IAAI,CAACI,CAAD,EAAIC,MAAM,CAACE,KAAX,CAAd;EACAD,GAAG,GAAGJ,UAAU,CAACI,GAAD,EAAMD,MAAM,CAACG,KAAb,CAAhB;EACAF,GAAG,GAAGP,EAAE,CAACU,GAAH,CAAOH,GAAP,EAAYF,CAAZ,CAAN;EACAE,GAAG,GAAGP,EAAE,CAACW,IAAH,CAAQJ,GAAR,CAAN;EACA,OAAOA,GAAP;AACD;AAED,OAAM,SAAUK,YAAV,CAAuBP,CAAvB,EAAuCC,MAAvC,EAAkE;EACtE,IAAIC,GAAG,GAAGL,QAAQ,CAACG,CAAD,EAAIC,MAAM,CAACE,KAAX,CAAlB;EACAD,GAAG,GAAGJ,UAAU,CAACI,GAAD,EAAMD,MAAM,CAACG,KAAb,CAAhB;EAEA,IAAII,MAAM,GAAGb,EAAE,CAACc,OAAH,CAAWT,CAAX,EAAc,CAAd,EAAiB,CAAjB,EAAoB,OAApB,CAAb;EACA,IAAMU,KAAK,GAAGf,EAAE,CAACe,KAAH,CAAqBF,MAAM,CAACG,KAA5B,CAAd;EACA,IAAMC,KAAK,GAAGJ,MAAM,CAACG,KAAP,CAAa,CAAb,MAAoBT,GAAG,CAACS,KAAJ,CAAU,CAAV,CAAlC;EACA,IAAME,aAAa,GAAGL,MAAM,CAACG,KAAP,CAAa,CAAb,MAAoBT,GAAG,CAACS,KAAJ,CAAU,CAAV,CAApB,IAAoCH,MAAM,CAACG,KAAP,CAAa,CAAb,MAAoBT,GAAG,CAACS,KAAJ,CAAU,CAAV,CAA9E;;EAEA,IAAIE,aAAJ,EAAmB;IACjB,IAAMC,SAAS,GAAGC,eAAIb,GAAG,CAACS,KAAR,CAAlB;;IACAG,SAAS,CAAC,CAAD,CAAT,GAAe,CAAf;IACA,IAAME,MAAM,GAAGrB,EAAE,CAACe,KAAH,CAAqBI,SAArB,CAAf;IACAZ,GAAG,GAAGP,EAAE,CAACsB,MAAH,CAAU,CAACf,GAAD,EAAMc,MAAN,CAAV,EAAyB,CAAzB,CAAN;;IAEA,IAAME,SAAS,GAAGH,eAAIb,GAAG,CAACS,KAAR,CAAlB;;IACAO,SAAS,CAAC,CAAD,CAAT,GAAe,CAAf;IACA,IAAMC,MAAM,GAAGxB,EAAE,CAACe,KAAH,CAAqBQ,SAArB,CAAf;IACAhB,GAAG,GAAGP,EAAE,CAACsB,MAAH,CAAU,CAACf,GAAD,EAAMiB,MAAN,CAAV,EAAyB,CAAzB,CAAN;EACD;;EAEDX,MAAM,GAAGI,KAAK,GAAGjB,EAAE,CAACsB,MAAH,CAAU,CAACT,MAAD,EAASE,KAAT,CAAV,EAA2B,CAA3B,CAAH,GAAmCF,MAAjD;EACAN,GAAG,GAAGP,EAAE,CAACU,GAAH,CAAOG,MAAP,EAAeN,GAAf,CAAN;EAEAA,GAAG,GAAGP,EAAE,CAACW,IAAH,CAAQJ,GAAR,CAAN;EACA,OAAOA,GAAP;AACD","names":["tf","conv","convDown","convNoRelu","residual","x","params","out","conv1","conv2","add","relu","residualDown","pooled","avgPool","zeros","shape","isPad","isAdjustShape","padShapeX","__spreadArrays","zerosW","concat","padShapeY","zerosH"],"sources":["../../../src/faceRecognitionNet/residualLayer.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}