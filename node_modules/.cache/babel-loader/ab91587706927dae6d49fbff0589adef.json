{"ast":null,"code":"var _jsxFileName = \"/Users/maraclupanciuc/Desktop/SmartBrain/face-detection/face_detection/src/components/Stream/Stream.jsx\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport './stream.css';\nimport * as faceapi from 'face-api.js';\nimport '../../models/';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Stream() {\n  _s();\n\n  const [modelsLoaded, setModelsLoaded] = React.useState(false);\n  const [captureVideo, setCaptureVideo] = React.useState(false);\n  const videoRef = React.useRef();\n  const videoHeight = 480;\n  const videoWidth = 640;\n  const canvasRef = React.useRef();\n  React.useEffect(() => {\n    const loadModels = async () => {\n      const MODEL_URL = '../../models';\n      Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL), faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL)]).then(setModelsLoaded(true)).then(console.log(faceapi.nets.tinyFaceDetector));\n    };\n\n    loadModels();\n  }, []);\n\n  const startVideo = () => {\n    setCaptureVideo(true);\n    navigator.mediaDevices.getUserMedia({\n      video: {\n        width: 300\n      }\n    }).then(stream => {\n      let video = videoRef.current;\n      video.srcObject = stream;\n      video.play();\n    }).catch(err => {\n      console.error(\"error:\", err);\n    });\n  };\n\n  const handleVideoOnPlay = () => {\n    setInterval(async () => {\n      if (canvasRef && canvasRef.current) {\n        canvasRef.current.innerHTML = faceapi.createCanvasFromMedia(videoRef.current);\n        const displaySize = {\n          width: videoWidth,\n          height: videoHeight\n        };\n        faceapi.matchDimensions(canvasRef.current, displaySize);\n        const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\n        const resizedDetections = faceapi.resizeResults(detections, displaySize);\n        canvasRef && canvasRef.current && canvasRef.current.getContext('2d').clearRect(0, 0, videoWidth, videoHeight);\n        canvasRef && canvasRef.current && faceapi.draw.drawDetections(canvasRef.current, resizedDetections);\n        canvasRef && canvasRef.current && faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetections);\n        canvasRef && canvasRef.current && faceapi.draw.drawFaceExpressions(canvasRef.current, resizedDetections);\n      }\n    }, 100);\n  };\n\n  const closeWebcam = () => {\n    videoRef.current.pause();\n    videoRef.current.srcObject.getTracks()[0].stop();\n    setCaptureVideo(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"open-close\",\n      children: captureVideo && modelsLoaded ? /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: closeWebcam,\n        children: \"Stop scanning\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: startVideo,\n        children: \"Scan your face\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this), captureVideo ? modelsLoaded ? /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"player\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          className: \"video\",\n          ref: videoRef,\n          height: videoHeight,\n          width: videoWidth,\n          onPlay: handleVideoOnPlay\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n          className: \"canvas\",\n          ref: canvasRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Stream, \"r7/G1Z43y30xxZApC/YFouB9GI0=\");\n\n_c = Stream;\nexport default Stream;\n\nvar _c;\n\n$RefreshReg$(_c, \"Stream\");","map":{"version":3,"names":["React","faceapi","Stream","modelsLoaded","setModelsLoaded","useState","captureVideo","setCaptureVideo","videoRef","useRef","videoHeight","videoWidth","canvasRef","useEffect","loadModels","MODEL_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","faceExpressionNet","then","console","log","startVideo","navigator","mediaDevices","getUserMedia","video","width","stream","current","srcObject","play","catch","err","error","handleVideoOnPlay","setInterval","innerHTML","createCanvasFromMedia","displaySize","height","matchDimensions","detections","detectAllFaces","TinyFaceDetectorOptions","withFaceLandmarks","withFaceExpressions","resizedDetections","resizeResults","getContext","clearRect","draw","drawDetections","drawFaceLandmarks","drawFaceExpressions","closeWebcam","pause","getTracks","stop"],"sources":["/Users/maraclupanciuc/Desktop/SmartBrain/face-detection/face_detection/src/components/Stream/Stream.jsx"],"sourcesContent":["import React from 'react';\n\nimport './stream.css'\n\nimport * as faceapi from 'face-api.js';\nimport '../../models/'\n\n\nfunction Stream() {\n\n  const [modelsLoaded, setModelsLoaded] = React.useState(false);\n  const [captureVideo, setCaptureVideo] = React.useState(false);\n\n  const videoRef = React.useRef();\n  const videoHeight = 480;\n  const videoWidth = 640;\n  const canvasRef = React.useRef();\n\n  React.useEffect(() => {\n    const loadModels = async () => {\n      const MODEL_URL = '../../models';\n\n\n      Promise.all([\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\n        faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL),\n      ]).then(setModelsLoaded(true)).then(console.log(faceapi.nets.tinyFaceDetector))\n    }\n    loadModels();\n  }, []);\n\n  const startVideo = () => {\n    setCaptureVideo(true);\n    navigator.mediaDevices\n      .getUserMedia({ video: { width: 300 } })\n      .then(stream => {\n        let video = videoRef.current;\n        video.srcObject = stream;\n        video.play();\n      })\n      .catch(err => {\n        console.error(\"error:\", err);\n      });\n  }\n\n  const handleVideoOnPlay = () => {\n    setInterval(async () => {\n      if (canvasRef && canvasRef.current) {\n        canvasRef.current.innerHTML = faceapi.createCanvasFromMedia(videoRef.current);\n        const displaySize = {\n          width: videoWidth,\n          height: videoHeight\n        }\n\n        faceapi.matchDimensions(canvasRef.current, displaySize);\n\n        const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\n\n        const resizedDetections = faceapi.resizeResults(detections, displaySize);\n\n        canvasRef && canvasRef.current && canvasRef.current.getContext('2d').clearRect(0, 0, videoWidth, videoHeight);\n        canvasRef && canvasRef.current && faceapi.draw.drawDetections(canvasRef.current, resizedDetections);\n        canvasRef && canvasRef.current && faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetections);\n        canvasRef && canvasRef.current && faceapi.draw.drawFaceExpressions(canvasRef.current, resizedDetections);\n      }\n    }, 100)\n  }\n  const closeWebcam = () => {\n    videoRef.current.pause();\n    videoRef.current.srcObject.getTracks()[0].stop();\n    setCaptureVideo(false);\n  }\n\n  return (\n    <div>\n      <div className='open-close'>\n        {\n          captureVideo && modelsLoaded ?\n            <button className='btn' onClick={closeWebcam}>\n              Stop scanning\n            </button>\n            :\n            <button className='btn' onClick={startVideo}>\n              Scan your face\n            </button>\n        }\n      </div>\n      {\n        captureVideo ?\n          modelsLoaded ?\n            <div>\n              <div className='player'>\n                <video className='video' ref={videoRef} height={videoHeight} width={videoWidth} onPlay={handleVideoOnPlay} />\n                <canvas  className='canvas' ref={canvasRef}/>\n              </div>\n            </div>\n            :\n            <div>loading...</div>\n          :\n          <>\n          </>\n      }\n    </div>\n  );\n}\nexport default Stream;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}