{"ast":null,"code":"import { FaceMatch } from '../classes/FaceMatch';\nimport { LabeledFaceDescriptors } from '../classes/LabeledFaceDescriptors';\nimport { euclideanDistance } from '../euclideanDistance';\n\nvar FaceMatcher =\n/** @class */\nfunction () {\n  function FaceMatcher(inputs, distanceThreshold) {\n    if (distanceThreshold === void 0) {\n      distanceThreshold = 0.6;\n    }\n\n    this._distanceThreshold = distanceThreshold;\n    var inputArray = Array.isArray(inputs) ? inputs : [inputs];\n\n    if (!inputArray.length) {\n      throw new Error(\"FaceRecognizer.constructor - expected atleast one input\");\n    }\n\n    var count = 1;\n\n    var createUniqueLabel = function () {\n      return \"person \" + count++;\n    };\n\n    this._labeledDescriptors = inputArray.map(function (desc) {\n      if (desc instanceof LabeledFaceDescriptors) {\n        return desc;\n      }\n\n      if (desc instanceof Float32Array) {\n        return new LabeledFaceDescriptors(createUniqueLabel(), [desc]);\n      }\n\n      if (desc.descriptor && desc.descriptor instanceof Float32Array) {\n        return new LabeledFaceDescriptors(createUniqueLabel(), [desc.descriptor]);\n      }\n\n      throw new Error(\"FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>\");\n    });\n  }\n\n  Object.defineProperty(FaceMatcher.prototype, \"labeledDescriptors\", {\n    get: function () {\n      return this._labeledDescriptors;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(FaceMatcher.prototype, \"distanceThreshold\", {\n    get: function () {\n      return this._distanceThreshold;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  FaceMatcher.prototype.computeMeanDistance = function (queryDescriptor, descriptors) {\n    return descriptors.map(function (d) {\n      return euclideanDistance(d, queryDescriptor);\n    }).reduce(function (d1, d2) {\n      return d1 + d2;\n    }, 0) / (descriptors.length || 1);\n  };\n\n  FaceMatcher.prototype.matchDescriptor = function (queryDescriptor) {\n    var _this = this;\n\n    return this.labeledDescriptors.map(function (_a) {\n      var descriptors = _a.descriptors,\n          label = _a.label;\n      return new FaceMatch(label, _this.computeMeanDistance(queryDescriptor, descriptors));\n    }).reduce(function (best, curr) {\n      return best.distance < curr.distance ? best : curr;\n    });\n  };\n\n  FaceMatcher.prototype.findBestMatch = function (queryDescriptor) {\n    var bestMatch = this.matchDescriptor(queryDescriptor);\n    return bestMatch.distance < this.distanceThreshold ? bestMatch : new FaceMatch('unknown', bestMatch.distance);\n  };\n\n  FaceMatcher.prototype.toJSON = function () {\n    return {\n      distanceThreshold: this.distanceThreshold,\n      labeledDescriptors: this.labeledDescriptors.map(function (ld) {\n        return ld.toJSON();\n      })\n    };\n  };\n\n  FaceMatcher.fromJSON = function (json) {\n    var labeledDescriptors = json.labeledDescriptors.map(function (ld) {\n      return LabeledFaceDescriptors.fromJSON(ld);\n    });\n    return new FaceMatcher(labeledDescriptors, json.distanceThreshold);\n  };\n\n  return FaceMatcher;\n}();\n\nexport { FaceMatcher };","map":{"version":3,"mappings":"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","names":["FaceMatch","LabeledFaceDescriptors","euclideanDistance","inputs","distanceThreshold","_distanceThreshold","inputArray","Array","isArray","length","Error","count","createUniqueLabel","_labeledDescriptors","map","desc","Float32Array","descriptor","Object","FaceMatcher","queryDescriptor","descriptors","d","reduce","d1","d2","labeledDescriptors","_a","label","_this","computeMeanDistance","best","curr","distance","bestMatch","matchDescriptor","ld","toJSON","json","fromJSON"],"sources":["../../../src/globalApi/FaceMatcher.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}