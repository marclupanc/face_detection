{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { extendWithFaceExpressions } from '../factories/WithFaceExpressions';\nimport { ComposableTask } from './ComposableTask';\nimport { ComputeAllFaceDescriptorsTask, ComputeSingleFaceDescriptorTask } from './ComputeFaceDescriptorsTasks';\nimport { extractAllFacesAndComputeResults, extractSingleFaceAndComputeResult } from './extractFacesAndComputeResults';\nimport { nets } from './nets';\nimport { PredictAllAgeAndGenderTask, PredictAllAgeAndGenderWithFaceAlignmentTask, PredictSingleAgeAndGenderTask, PredictSingleAgeAndGenderWithFaceAlignmentTask } from './PredictAgeAndGenderTask';\n\nvar PredictFaceExpressionsTaskBase =\n/** @class */\nfunction (_super) {\n  __extends(PredictFaceExpressionsTaskBase, _super);\n\n  function PredictFaceExpressionsTaskBase(parentTask, input, extractedFaces) {\n    var _this = _super.call(this) || this;\n\n    _this.parentTask = parentTask;\n    _this.input = input;\n    _this.extractedFaces = extractedFaces;\n    return _this;\n  }\n\n  return PredictFaceExpressionsTaskBase;\n}(ComposableTask);\n\nexport { PredictFaceExpressionsTaskBase };\n\nvar PredictAllFaceExpressionsTask =\n/** @class */\nfunction (_super) {\n  __extends(PredictAllFaceExpressionsTask, _super);\n\n  function PredictAllFaceExpressionsTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PredictAllFaceExpressionsTask.prototype.run = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var parentResults, faceExpressionsByFace;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.parentTask];\n\n          case 1:\n            parentResults = _a.sent();\n            return [4\n            /*yield*/\n            , extractAllFacesAndComputeResults(parentResults, this.input, function (faces) {\n              return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4\n                      /*yield*/\n                      , Promise.all(faces.map(function (face) {\n                        return nets.faceExpressionNet.predictExpressions(face);\n                      }))];\n\n                    case 1:\n                      return [2\n                      /*return*/\n                      , _a.sent()];\n                  }\n                });\n              });\n            }, this.extractedFaces)];\n\n          case 2:\n            faceExpressionsByFace = _a.sent();\n            return [2\n            /*return*/\n            , parentResults.map(function (parentResult, i) {\n              return extendWithFaceExpressions(parentResult, faceExpressionsByFace[i]);\n            })];\n        }\n      });\n    });\n  };\n\n  PredictAllFaceExpressionsTask.prototype.withAgeAndGender = function () {\n    return new PredictAllAgeAndGenderTask(this, this.input);\n  };\n\n  return PredictAllFaceExpressionsTask;\n}(PredictFaceExpressionsTaskBase);\n\nexport { PredictAllFaceExpressionsTask };\n\nvar PredictSingleFaceExpressionsTask =\n/** @class */\nfunction (_super) {\n  __extends(PredictSingleFaceExpressionsTask, _super);\n\n  function PredictSingleFaceExpressionsTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PredictSingleFaceExpressionsTask.prototype.run = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var parentResult, faceExpressions;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.parentTask];\n\n          case 1:\n            parentResult = _a.sent();\n\n            if (!parentResult) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , extractSingleFaceAndComputeResult(parentResult, this.input, function (face) {\n              return nets.faceExpressionNet.predictExpressions(face);\n            }, this.extractedFaces)];\n\n          case 2:\n            faceExpressions = _a.sent();\n            return [2\n            /*return*/\n            , extendWithFaceExpressions(parentResult, faceExpressions)];\n        }\n      });\n    });\n  };\n\n  PredictSingleFaceExpressionsTask.prototype.withAgeAndGender = function () {\n    return new PredictSingleAgeAndGenderTask(this, this.input);\n  };\n\n  return PredictSingleFaceExpressionsTask;\n}(PredictFaceExpressionsTaskBase);\n\nexport { PredictSingleFaceExpressionsTask };\n\nvar PredictAllFaceExpressionsWithFaceAlignmentTask =\n/** @class */\nfunction (_super) {\n  __extends(PredictAllFaceExpressionsWithFaceAlignmentTask, _super);\n\n  function PredictAllFaceExpressionsWithFaceAlignmentTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PredictAllFaceExpressionsWithFaceAlignmentTask.prototype.withAgeAndGender = function () {\n    return new PredictAllAgeAndGenderWithFaceAlignmentTask(this, this.input);\n  };\n\n  PredictAllFaceExpressionsWithFaceAlignmentTask.prototype.withFaceDescriptors = function () {\n    return new ComputeAllFaceDescriptorsTask(this, this.input);\n  };\n\n  return PredictAllFaceExpressionsWithFaceAlignmentTask;\n}(PredictAllFaceExpressionsTask);\n\nexport { PredictAllFaceExpressionsWithFaceAlignmentTask };\n\nvar PredictSingleFaceExpressionsWithFaceAlignmentTask =\n/** @class */\nfunction (_super) {\n  __extends(PredictSingleFaceExpressionsWithFaceAlignmentTask, _super);\n\n  function PredictSingleFaceExpressionsWithFaceAlignmentTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PredictSingleFaceExpressionsWithFaceAlignmentTask.prototype.withAgeAndGender = function () {\n    return new PredictSingleAgeAndGenderWithFaceAlignmentTask(this, this.input);\n  };\n\n  PredictSingleFaceExpressionsWithFaceAlignmentTask.prototype.withFaceDescriptor = function () {\n    return new ComputeSingleFaceDescriptorTask(this, this.input);\n  };\n\n  return PredictSingleFaceExpressionsWithFaceAlignmentTask;\n}(PredictSingleFaceExpressionsTask);\n\nexport { PredictSingleFaceExpressionsWithFaceAlignmentTask };","map":{"version":3,"mappings":"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","names":["extendWithFaceExpressions","ComposableTask","ComputeAllFaceDescriptorsTask","ComputeSingleFaceDescriptorTask","extractAllFacesAndComputeResults","extractSingleFaceAndComputeResult","nets","PredictAllAgeAndGenderTask","PredictAllAgeAndGenderWithFaceAlignmentTask","PredictSingleAgeAndGenderTask","PredictSingleAgeAndGenderWithFaceAlignmentTask","__extends","parentTask","input","extractedFaces","_super","_this","PredictAllFaceExpressionsTask","parentResults","_a","faces","Promise","all","map","faceExpressionNet","predictExpressions","face","faceExpressionsByFace","parentResult","i","PredictFaceExpressionsTaskBase","PredictSingleFaceExpressionsTask","faceExpressions","PredictAllFaceExpressionsWithFaceAlignmentTask","PredictSingleFaceExpressionsWithFaceAlignmentTask"],"sources":["../../../src/globalApi/PredictFaceExpressionsTask.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}