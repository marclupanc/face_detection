{"ast":null,"code":"export function nonMaxSuppression(boxes, scores, maxOutputSize, iouThreshold, scoreThreshold) {\n  var numBoxes = boxes.shape[0];\n  var outputSize = Math.min(maxOutputSize, numBoxes);\n  var candidates = scores.map(function (score, boxIndex) {\n    return {\n      score: score,\n      boxIndex: boxIndex\n    };\n  }).filter(function (c) {\n    return c.score > scoreThreshold;\n  }).sort(function (c1, c2) {\n    return c2.score - c1.score;\n  });\n\n  var suppressFunc = function (x) {\n    return x <= iouThreshold ? 1 : 0;\n  };\n\n  var selected = [];\n  candidates.forEach(function (c) {\n    if (selected.length >= outputSize) {\n      return;\n    }\n\n    var originalScore = c.score;\n\n    for (var j = selected.length - 1; j >= 0; --j) {\n      var iou = IOU(boxes, c.boxIndex, selected[j]);\n\n      if (iou === 0.0) {\n        continue;\n      }\n\n      c.score *= suppressFunc(iou);\n\n      if (c.score <= scoreThreshold) {\n        break;\n      }\n    }\n\n    if (originalScore === c.score) {\n      selected.push(c.boxIndex);\n    }\n  });\n  return selected;\n}\n\nfunction IOU(boxes, i, j) {\n  var boxesData = boxes.arraySync();\n  var yminI = Math.min(boxesData[i][0], boxesData[i][2]);\n  var xminI = Math.min(boxesData[i][1], boxesData[i][3]);\n  var ymaxI = Math.max(boxesData[i][0], boxesData[i][2]);\n  var xmaxI = Math.max(boxesData[i][1], boxesData[i][3]);\n  var yminJ = Math.min(boxesData[j][0], boxesData[j][2]);\n  var xminJ = Math.min(boxesData[j][1], boxesData[j][3]);\n  var ymaxJ = Math.max(boxesData[j][0], boxesData[j][2]);\n  var xmaxJ = Math.max(boxesData[j][1], boxesData[j][3]);\n  var areaI = (ymaxI - yminI) * (xmaxI - xminI);\n  var areaJ = (ymaxJ - yminJ) * (xmaxJ - xminJ);\n\n  if (areaI <= 0 || areaJ <= 0) {\n    return 0.0;\n  }\n\n  var intersectionYmin = Math.max(yminI, yminJ);\n  var intersectionXmin = Math.max(xminI, xminJ);\n  var intersectionYmax = Math.min(ymaxI, ymaxJ);\n  var intersectionXmax = Math.min(xmaxI, xmaxJ);\n  var intersectionArea = Math.max(intersectionYmax - intersectionYmin, 0.0) * Math.max(intersectionXmax - intersectionXmin, 0.0);\n  return intersectionArea / (areaI + areaJ - intersectionArea);\n}","map":{"version":3,"mappings":"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","names":["nonMaxSuppression","boxes","scores","maxOutputSize","iouThreshold","scoreThreshold","numBoxes","shape","outputSize","Math","min","candidates","map","score","boxIndex","filter","sort","c1","c2","suppressFunc","x","selected","forEach","length","originalScore","c","j","iou","IOU","push","i","boxesData","arraySync","yminI","xminI","ymaxI","max","xmaxI","yminJ","xminJ","ymaxJ","xmaxJ","areaI","areaJ","intersectionYmin","intersectionXmin","intersectionYmax","intersectionXmax","intersectionArea"],"sources":["../../../src/ssdMobilenetv1/nonMaxSuppression.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}